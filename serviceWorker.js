var staticCacheName = "pwa-v" + new Date().getTime();
var filesToCache = [
    '.htaccess',
    'manifest.json',
    'index.html',
    'style.css',
    'script.js',
    'res/favicon.png',
    'res/favicon_maskable.png',
    'res/audio/correct.mp3',
    'res/audio/incorrect.mp3',
    'res/lib/fuzzysort-min.js',
    'res/lib/leaflet.js',
    'res/lib/leaflet.css',
    'res/lib/leaflet.js.map',
    'res/lib/smooth-zoom.js',
    'res/data/cities.json',
    'res/data/countries.geojson',
    'res/data/countryAliases.json',
    'res/data/countryInfo.json',
    'res/fonts/FiraCode-VariableFont_wght.ttf',
    'res/flags/AFG.svg',
    'res/flags/ALA.svg',
    'res/flags/ALB.svg',
    'res/flags/DZA.svg',
    'res/flags/ASM.svg',
    'res/flags/AND.svg',
    'res/flags/AGO.svg',
    'res/flags/AIA.svg',
    'res/flags/ATA.svg',
    'res/flags/ATG.svg',
    'res/flags/ARG.svg',
    'res/flags/ARM.svg',
    'res/flags/ABW.svg',
    'res/flags/AUS.svg',
    'res/flags/AUT.svg',
    'res/flags/AZE.svg',
    'res/flags/BHS.svg',
    'res/flags/BHR.svg',
    'res/flags/BGD.svg',
    'res/flags/BRB.svg',
    'res/flags/BLR.svg',
    'res/flags/BEL.svg',
    'res/flags/BLZ.svg',
    'res/flags/BEN.svg',
    'res/flags/BMU.svg',
    'res/flags/BTN.svg',
    'res/flags/BOL.svg',
    'res/flags/BES.svg',
    'res/flags/BIH.svg',
    'res/flags/BWA.svg',
    'res/flags/BVT.svg',
    'res/flags/BRA.svg',
    'res/flags/IOT.svg',
    'res/flags/VGB.svg',
    'res/flags/VIR.svg',
    'res/flags/BRN.svg',
    'res/flags/BGR.svg',
    'res/flags/BFA.svg',
    'res/flags/BDI.svg',
    'res/flags/KHM.svg',
    'res/flags/CMR.svg',
    'res/flags/CAN.svg',
    'res/flags/CPV.svg',
    'res/flags/CYM.svg',
    'res/flags/CAF.svg',
    'res/flags/TCD.svg',
    'res/flags/CHL.svg',
    'res/flags/CHN.svg',
    'res/flags/CXR.svg',
    'res/flags/CCK.svg',
    'res/flags/COL.svg',
    'res/flags/COM.svg',
    'res/flags/COG.svg',
    'res/flags/COD.svg',
    'res/flags/COK.svg',
    'res/flags/CRI.svg',
    'res/flags/HRV.svg',
    'res/flags/CUB.svg',
    'res/flags/CUW.svg',
    'res/flags/CYP.svg',
    'res/flags/CZE.svg',
    'res/flags/DNK.svg',
    'res/flags/DJI.svg',
    'res/flags/DMA.svg',
    'res/flags/DOM.svg',
    'res/flags/ECU.svg',
    'res/flags/EGY.svg',
    'res/flags/SLV.svg',
    'res/flags/GNQ.svg',
    'res/flags/ERI.svg',
    'res/flags/EST.svg',
    'res/flags/ETH.svg',
    'res/flags/FLK.svg',
    'res/flags/FRO.svg',
    'res/flags/FJI.svg',
    'res/flags/FIN.svg',
    'res/flags/FRA.svg',
    'res/flags/GUF.svg',
    'res/flags/PYF.svg',
    'res/flags/ATF.svg',
    'res/flags/GAB.svg',
    'res/flags/GMB.svg',
    'res/flags/GEO.svg',
    'res/flags/DEU.svg',
    'res/flags/GHA.svg',
    'res/flags/GIB.svg',
    'res/flags/GRC.svg',
    'res/flags/GRL.svg',
    'res/flags/GRD.svg',
    'res/flags/GLP.svg',
    'res/flags/GUM.svg',
    'res/flags/GTM.svg',
    'res/flags/GGY.svg',
    'res/flags/GIN.svg',
    'res/flags/GNB.svg',
    'res/flags/GUY.svg',
    'res/flags/HTI.svg',
    'res/flags/HMD.svg',
    'res/flags/VAT.svg',
    'res/flags/HND.svg',
    'res/flags/HKG.svg',
    'res/flags/HUN.svg',
    'res/flags/ISL.svg',
    'res/flags/IND.svg',
    'res/flags/IDN.svg',
    'res/flags/CIV.svg',
    'res/flags/IRN.svg',
    'res/flags/IRQ.svg',
    'res/flags/IRL.svg',
    'res/flags/IMN.svg',
    'res/flags/ISR.svg',
    'res/flags/ITA.svg',
    'res/flags/JAM.svg',
    'res/flags/JPN.svg',
    'res/flags/JEY.svg',
    'res/flags/JOR.svg',
    'res/flags/KAZ.svg',
    'res/flags/KEN.svg',
    'res/flags/KIR.svg',
    'res/flags/KWT.svg',
    'res/flags/KGZ.svg',
    'res/flags/LAO.svg',
    'res/flags/LVA.svg',
    'res/flags/LBN.svg',
    'res/flags/LSO.svg',
    'res/flags/LBR.svg',
    'res/flags/LBY.svg',
    'res/flags/LIE.svg',
    'res/flags/LTU.svg',
    'res/flags/LUX.svg',
    'res/flags/MAC.svg',
    'res/flags/MKD.svg',
    'res/flags/MDG.svg',
    'res/flags/MWI.svg',
    'res/flags/MYS.svg',
    'res/flags/MDV.svg',
    'res/flags/MLI.svg',
    'res/flags/MLT.svg',
    'res/flags/MHL.svg',
    'res/flags/MTQ.svg',
    'res/flags/MRT.svg',
    'res/flags/MUS.svg',
    'res/flags/MYT.svg',
    'res/flags/MEX.svg',
    'res/flags/FSM.svg',
    'res/flags/MDA.svg',
    'res/flags/MCO.svg',
    'res/flags/MNG.svg',
    'res/flags/MNE.svg',
    'res/flags/MSR.svg',
    'res/flags/MAR.svg',
    'res/flags/MOZ.svg',
    'res/flags/MMR.svg',
    'res/flags/NAM.svg',
    'res/flags/NRU.svg',
    'res/flags/NPL.svg',
    'res/flags/NLD.svg',
    'res/flags/NCL.svg',
    'res/flags/NZL.svg',
    'res/flags/NIC.svg',
    'res/flags/NER.svg',
    'res/flags/NGA.svg',
    'res/flags/NIU.svg',
    'res/flags/NFK.svg',
    'res/flags/PRK.svg',
    'res/flags/MNP.svg',
    'res/flags/NOR.svg',
    'res/flags/OMN.svg',
    'res/flags/PAK.svg',
    'res/flags/PLW.svg',
    'res/flags/PSE.svg',
    'res/flags/PAN.svg',
    'res/flags/PNG.svg',
    'res/flags/PRY.svg',
    'res/flags/PER.svg',
    'res/flags/PHL.svg',
    'res/flags/PCN.svg',
    'res/flags/POL.svg',
    'res/flags/PRT.svg',
    'res/flags/PRI.svg',
    'res/flags/QAT.svg',
    'res/flags/XKS.svg',
    'res/flags/REU.svg',
    'res/flags/ROU.svg',
    'res/flags/RUS.svg',
    'res/flags/RWA.svg',
    'res/flags/BLM.svg',
    'res/flags/SHN.svg',
    'res/flags/KNA.svg',
    'res/flags/LCA.svg',
    'res/flags/MAF.svg',
    'res/flags/SPM.svg',
    'res/flags/VCT.svg',
    'res/flags/WSM.svg',
    'res/flags/SMR.svg',
    'res/flags/STP.svg',
    'res/flags/SAU.svg',
    'res/flags/SEN.svg',
    'res/flags/SRB.svg',
    'res/flags/SYC.svg',
    'res/flags/SLE.svg',
    'res/flags/SGP.svg',
    'res/flags/SXM.svg',
    'res/flags/SVK.svg',
    'res/flags/SVN.svg',
    'res/flags/SLB.svg',
    'res/flags/SOM.svg',
    'res/flags/ZAF.svg',
    'res/flags/SGS.svg',
    'res/flags/KOR.svg',
    'res/flags/SSD.svg',
    'res/flags/ESP.svg',
    'res/flags/LKA.svg',
    'res/flags/SDN.svg',
    'res/flags/SUR.svg',
    'res/flags/SWZ.svg',
    'res/flags/SWE.svg',
    'res/flags/CHE.svg',
    'res/flags/SYR.svg',
    'res/flags/TWN.svg',
    'res/flags/TJK.svg',
    'res/flags/TZA.svg',
    'res/flags/THA.svg',
    'res/flags/TLS.svg',
    'res/flags/TGO.svg',
    'res/flags/TKL.svg',
    'res/flags/TON.svg',
    'res/flags/TTO.svg',
    'res/flags/TUN.svg',
    'res/flags/TUR.svg',
    'res/flags/TKM.svg',
    'res/flags/TCA.svg',
    'res/flags/TUV.svg',
    'res/flags/UGA.svg',
    'res/flags/UKR.svg',
    'res/flags/ARE.svg',
    'res/flags/GBR.svg',
    'res/flags/USA.svg',
    'res/flags/URY.svg',
    'res/flags/UZB.svg',
    'res/flags/VUT.svg',
    'res/flags/VEN.svg',
    'res/flags/VNM.svg',
    'res/flags/WLF.svg',
    'res/flags/ESH.svg',
    'res/flags/YEM.svg',
    'res/flags/ZMB.svg',
    'res/flags/ZWE.svg',
];

// Cache on install
self.addEventListener("install", event => {
    this.skipWaiting();
    event.waitUntil(
        caches.open(staticCacheName)
            .then(cache => {
                return cache.addAll(filesToCache);
            })
    )
});

// Clear cache on activate
self.addEventListener('activate', event => {
    event.waitUntil(
        caches.keys().then(cacheNames => {
            return Promise.all(
                cacheNames
                    .filter(cacheName => (cacheName.startsWith("pwa-")))
                    .filter(cacheName => (cacheName !== staticCacheName))
                    .map(cacheName => caches.delete(cacheName))
            );
        })
    );
});

// Serve from Cache
self.addEventListener("fetch", event => {
    event.respondWith(
        caches.match(event.request)
            .then(response => {
                return response || fetch(event.request);
            })
            .catch(() => {
                return caches.match('index.html');
            })
    )
});